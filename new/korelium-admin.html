<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Korelium Admin - Course Management</title>
    <meta name="description" content="Korelium administration panel for managing courses and content.">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/604803b7-b51d-4f0c-97be-e6ae5b305935.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="korelium-style.css">
    <style>
        /* Admin-specific styles */
        .admin-layout {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
            background: var(--bg-primary);
        }
        
        .admin-sidebar {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-primary);
            padding: var(--space-xl);
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .admin-main {
            margin-left: 280px;
            padding: var(--space-xl);
            min-height: 100vh;
        }
        
        .admin-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-2xl);
            padding-bottom: var(--space-lg);
            border-bottom: 1px solid var(--border-primary);
        }
        
        .admin-nav {
            list-style: none;
            margin: var(--space-2xl) 0;
        }
        
        .admin-nav-item {
            margin-bottom: var(--space-sm);
        }
        
        .admin-nav-link {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-lg);
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--radius-lg);
            transition: var(--transition-fast);
            font-weight: var(--font-medium);
        }
        
        .admin-nav-link:hover,
        .admin-nav-link.active {
            background: var(--bg-glass);
            color: var(--text-primary);
        }
        
        .admin-nav-link.active {
            background: var(--gradient-primary);
            color: white;
        }
        
        .course-form {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-xl);
            padding: var(--space-2xl);
            margin-bottom: var(--space-2xl);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-lg);
            margin-bottom: var(--space-lg);
        }
        
        .form-row.full {
            grid-template-columns: 1fr;
        }
        
        .courses-table {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-xl);
            overflow: hidden;
        }
        
        .table-header {
            background: var(--bg-tertiary);
            padding: var(--space-lg) var(--space-xl);
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .courses-list {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .course-row {
            display: grid;
            grid-template-columns: 60px 1fr auto auto auto;
            gap: var(--space-md);
            padding: var(--space-lg) var(--space-xl);
            border-bottom: 1px solid var(--border-primary);
            align-items: center;
            transition: var(--transition-fast);
        }
        
        .course-row:hover {
            background: var(--bg-glass);
        }
        
        .course-row:last-child {
            border-bottom: none;
        }
        
        .course-thumbnail {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            background: var(--bg-tertiary);
            object-fit: cover;
        }
        
        .course-info h4 {
            font-size: var(--text-base);
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            margin-bottom: var(--space-xs);
        }
        
        .course-info p {
            font-size: var(--text-sm);
            color: var(--text-tertiary);
        }
        
        .course-status {
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: var(--font-semibold);
            text-transform: uppercase;
        }
        
        .course-status.published {
            background: var(--status-success-bg);
            color: var(--status-success-text);
        }
        
        .course-status.draft {
            background: var(--status-warning-bg);
            color: var(--status-warning-text);
        }
        
        .course-actions {
            display: flex;
            gap: var(--space-sm);
        }
        
        .action-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .action-btn.edit {
            background: var(--status-info-bg);
            color: var(--status-info-text);
        }
        
        .action-btn.delete {
            background: var(--status-error-bg);
            color: var(--status-error-text);
        }
        
        .action-btn:hover {
            transform: scale(1.1);
        }
        
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-primary);
        }
        
        .login-form {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-xl);
            padding: var(--space-3xl);
            width: 100%;
            max-width: 400px;
            backdrop-filter: blur(20px);
        }
        
        .login-header {
            text-align: center;
            margin-bottom: var(--space-2xl);
        }
        
        .login-logo {
            width: 64px;
            height: 64px;
            border-radius: var(--radius-lg);
            margin: 0 auto var(--space-lg);
        }
        
        @media (max-width: 768px) {
            .admin-layout {
                grid-template-columns: 1fr;
            }
            
            .admin-sidebar {
                position: relative;
                width: 100%;
                height: auto;
            }
            
            .admin-main {
                margin-left: 0;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .course-row {
                grid-template-columns: 1fr;
                gap: var(--space-sm);
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-container">
        <div class="login-form">
            <div class="login-header">
                <img src="https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/604803b7-b51d-4f0c-97be-e6ae5b305935.png" alt="Korelium" class="login-logo">
                <h1>Admin Panel</h1>
                <p>Sign in to manage your courses</p>
            </div>
            <form id="admin-login-form">
                <div class="form-group">
                    <label for="admin-username">Username</label>
                    <input type="text" id="admin-username" name="username" required autofocus>
                </div>
                <div class="form-group">
                    <label for="admin-password">Password</label>
                    <input type="password" id="admin-password" name="password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <span>Sign In</span>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </button>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard" class="admin-layout" style="display: none;">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="admin-brand">
                <img src="https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/604803b7-b51d-4f0c-97be-e6ae5b305935.png" alt="Korelium" class="nav-logo">
                <span class="nav-title">Korelium Admin</span>
            </div>
            
            <nav class="admin-nav">
                <li class="admin-nav-item">
                    <a href="#dashboard" class="admin-nav-link active" data-admin-page="dashboard">
                        <span>📊</span>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="admin-nav-item">
                    <a href="#courses-manage" class="admin-nav-link" data-admin-page="courses-manage">
                        <span>📚</span>
                        <span>Manage Courses</span>
                    </a>
                </li>
                <li class="admin-nav-item">
                    <a href="#course-create" class="admin-nav-link" data-admin-page="course-create">
                        <span>➕</span>
                        <span>Add Course</span>
                    </a>
                </li>
                <li class="admin-nav-item">
                    <a href="#settings" class="admin-nav-link" data-admin-page="settings">
                        <span>⚙️</span>
                        <span>Settings</span>
                    </a>
                </li>
            </nav>
            
            <div class="admin-user">
                <div class="user-info">
                    <div class="user-avatar">A</div>
                    <div class="user-details">
                        <div class="user-name" id="admin-username-display">Admin User</div>
                        <div class="user-role">Administrator</div>
                    </div>
                </div>
                <button class="btn btn-outline" onclick="logoutAdmin()" style="width: 100%; margin-top: var(--space-lg);">
                    <span>Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Dashboard -->
            <section id="dashboard" class="admin-page active">
                <div class="admin-header">
                    <div>
                        <h1>Dashboard</h1>
                        <p>Overview of your learning platform</p>
                    </div>
                    <button id="admin-theme-toggle" class="theme-toggle">
                        <span class="theme-icon">🌙</span>
                    </button>
                </div>
                
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon">📚</div>
                        <div class="stat-content">
                            <div class="stat-number" id="total-courses">0</div>
                            <div class="stat-label">Total Courses</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">👥</div>
                        <div class="stat-content">
                            <div class="stat-number" id="total-students">0</div>
                            <div class="stat-label">Total Students</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">⭐</div>
                        <div class="stat-content">
                            <div class="stat-number" id="avg-rating">0</div>
                            <div class="stat-label">Average Rating</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">🏷️</div>
                        <div class="stat-content">
                            <div class="stat-number" id="total-categories">0</div>
                            <div class="stat-label">Categories</div>
                        </div>
                    </div>
                </div>

                <div class="recent-activity">
                    <h2>Recent Courses</h2>
                    <div id="recent-courses" class="courses-grid">
                        <!-- Recent courses will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Manage Courses -->
            <section id="courses-manage" class="admin-page" style="display: none;">
                <div class="admin-header">
                    <div>
                        <h1>Manage Courses</h1>
                        <p>View, edit, and delete your courses</p>
                    </div>
                    <button class="btn btn-primary" data-admin-page="course-create">
                        <span>Add New Course</span>
                        <span>➕</span>
                    </button>
                </div>
                
                <div class="courses-table">
                    <div class="table-header">
                        <h3>All Courses</h3>
                        <div class="table-actions">
                            <input type="text" id="course-search-admin" placeholder="Search courses..." class="search-input">
                            <button class="btn btn-outline" onclick="refreshCourses()">
                                <span>Refresh</span>
                            </button>
                        </div>
                    </div>
                    <div class="courses-list" id="admin-courses-list">
                        <!-- Courses will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Create/Edit Course -->
            <section id="course-create" class="admin-page" style="display: none;">
                <div class="admin-header">
                    <div>
                        <h1 id="course-form-title">Add New Course</h1>
                        <p>Create engaging content for your students</p>
                    </div>
                    <button class="btn btn-secondary" data-admin-page="courses-manage">
                        <span>← Back to Courses</span>
                    </button>
                </div>

                <form id="course-form" class="course-form" enctype="multipart/form-data">
                    <input type="hidden" id="course-id" name="courseId">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="course-title">Course Title *</label>
                            <input type="text" id="course-title" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="course-slug">URL Slug *</label>
                            <input type="text" id="course-slug" name="slug" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="course-category">Category *</label>
                            <select id="course-category" name="category" required>
                                <option value="">Select Category</option>
                                <option value="technology">Technology</option>
                                <option value="finance">Finance</option>
                                <option value="trading">Trading</option>
                                <option value="travel">Travel</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="course-level">Level *</label>
                            <select id="course-level" name="level" required>
                                <option value="">Select Level</option>
                                <option value="beginner">Beginner</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="advanced">Advanced</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="course-instructor">Instructor *</label>
                            <input type="text" id="course-instructor" name="instructor" required>
                        </div>
                        <div class="form-group">
                            <label for="course-duration">Duration</label>
                            <input type="text" id="course-duration" name="duration" placeholder="e.g., 8 weeks">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="course-students">Students Enrolled</label>
                            <input type="number" id="course-students" name="students" min="0">
                        </div>
                        <div class="form-group">
                            <label for="course-rating">Rating</label>
                            <input type="number" id="course-rating" name="rating" min="0" max="5" step="0.1">
                        </div>
                    </div>
                    
                    <div class="form-row full">
                        <div class="form-group">
                            <label for="course-description">Short Description *</label>
                            <textarea id="course-description" name="description" rows="3" required></textarea>
                        </div>
                    </div>
                    
                    <div class="form-row full">
                        <div class="form-group">
                            <label for="course-full-description">Full Description</label>
                            <textarea id="course-full-description" name="fullDescription" rows="8"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="course-prerequisites">Prerequisites</label>
                            <input type="text" id="course-prerequisites" name="prerequisites" placeholder="e.g., Basic programming knowledge">
                        </div>
                        <div class="form-group">
                            <label for="course-language">Language</label>
                            <input type="text" id="course-language" name="language" placeholder="e.g., English">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="course-udemy-link">Udemy Link</label>
                            <input type="url" id="course-udemy-link" name="udemyLink" placeholder="https://udemy.com/course/...">
                        </div>
                        <div class="form-group">
                            <label for="course-image">Course Image</label>
                            <input type="file" id="course-image" name="image" accept="image/*">
                        </div>
                    </div>
                    
                    <div class="form-row full">
                        <div class="form-group">
                            <label for="course-tags">Tags (comma-separated)</label>
                            <input type="text" id="course-tags" name="tags" placeholder="e.g., javascript, react, frontend">
                        </div>
                    </div>
                    
                    <div class="form-row full">
                        <div class="form-group">
                            <label for="course-what-learn">What You'll Learn (one per line)</label>
                            <textarea id="course-what-learn" name="whatYoullLearn" rows="6" placeholder="Enter learning objectives, one per line"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="course-certificate" name="certificate">
                                <span>Certificate Available</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="course-last-updated">Last Updated</label>
                            <input type="date" id="course-last-updated" name="lastUpdated">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <span id="submit-text">Create Course</span>
                            <span>💾</span>
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="resetCourseForm()">
                            <span>Reset</span>
                        </button>
                    </div>
                </form>
            </section>

            <!-- Settings -->
            <section id="settings" class="admin-page" style="display: none;">
                <div class="admin-header">
                    <div>
                        <h1>Settings</h1>
                        <p>Configure your platform</p>
                    </div>
                </div>
                
                <div class="settings-content">
                    <div class="setting-group">
                        <h3>Appearance</h3>
                        <div class="setting-item">
                            <label>Theme</label>
                            <button id="settings-theme-toggle" class="btn btn-outline">
                                <span id="current-theme">Dark Mode</span>
                                <span>🎨</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <h3>API Information</h3>
                        <div class="setting-item">
                            <label>Base URL</label>
                            <input type="text" value="http://localhost:9000" readonly>
                        </div>
                        <div class="setting-item">
                            <label>Status</label>
                            <span id="api-status" class="course-status">Checking...</span>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="notification-container"></div>

    <!-- Scripts -->
    <script>
        // Admin-specific JavaScript
        const AdminConfig = {
            API_BASE_URL: 'http://localhost:9000',
            ENDPOINTS: {
                ADMIN_LOGIN: '/api/admin/login',
                COURSES: '/api/courses',
                COURSES_PUBLIC: '/public/courses'
            }
        };

        let adminToken = localStorage.getItem('korelium-admin-token');
        let currentEditingCourse = null;

        // Initialize admin panel
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔐 Admin panel initializing...');
            
            if (adminToken) {
                showAdminDashboard();
                loadAdminData();
            } else {
                showLoginScreen();
            }
            
            initializeAdminHandlers();
        });

        function initializeAdminHandlers() {
            // Login form
            const loginForm = document.getElementById('admin-login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', handleAdminLogin);
            }
            
            // Course form
            const courseForm = document.getElementById('course-form');
            if (courseForm) {
                courseForm.addEventListener('submit', handleCourseSubmit);
            }
            
            // Admin navigation
            document.addEventListener('click', function(e) {
                const navLink = e.target.closest('[data-admin-page]');
                if (navLink) {
                    e.preventDefault();
                    const page = navLink.getAttribute('data-admin-page');
                    navigateAdminPage(page);
                }
            });
            
            // Auto-generate slug from title
            const titleInput = document.getElementById('course-title');
            const slugInput = document.getElementById('course-slug');
            if (titleInput && slugInput) {
                titleInput.addEventListener('input', function() {
                    if (!currentEditingCourse) { // Only auto-generate for new courses
                        slugInput.value = generateSlug(this.value);
                    }
                });
            }
            
            // Theme toggle for admin
            const adminThemeToggle = document.getElementById('admin-theme-toggle');
            if (adminThemeToggle) {
                adminThemeToggle.addEventListener('click', toggleTheme);
                updateThemeToggleIcon();
            }
            
            console.log('✅ Admin handlers initialized');
        }

        async function handleAdminLogin(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const username = formData.get('username');
            const password = formData.get('password');
            
            try {
                const submitBtn = e.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<span>Signing In...</span><div class="loading-spinner" style="width: 20px; height: 20px;"></div>';
                submitBtn.disabled = true;
                
                const response = await fetch(`${AdminConfig.API_BASE_URL}${AdminConfig.ENDPOINTS.ADMIN_LOGIN}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (response.ok && data.token) {
                    adminToken = data.token;
                    localStorage.setItem('korelium-admin-token', adminToken);
                    
                    // Update username display
                    const usernameDisplay = document.getElementById('admin-username-display');
                    if (usernameDisplay) {
                        usernameDisplay.textContent = data.username;
                    }
                    
                    showNotification('Login successful!', 'success');
                    showAdminDashboard();
                    loadAdminData();
                } else {
                    throw new Error(data.message || 'Login failed');
                }
            } catch (error) {
                console.error('❌ Admin login error:', error);
                showNotification(error.message || 'Login failed', 'error');
                
                const submitBtn = e.target.querySelector('button[type="submit"]');
                submitBtn.innerHTML = '<span>Sign In</span><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>';
                submitBtn.disabled = false;
            }
        }

        function showLoginScreen() {
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('admin-dashboard').style.display = 'none';
        }

        function showAdminDashboard() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('admin-dashboard').style.display = 'grid';
        }

        function logoutAdmin() {
            adminToken = null;
            localStorage.removeItem('korelium-admin-token');
            showNotification('Logged out successfully', 'info');
            showLoginScreen();
        }

        function navigateAdminPage(page) {
            // Hide all admin pages
            const pages = document.querySelectorAll('.admin-page');
            pages.forEach(p => {
                p.style.display = 'none';
                p.classList.remove('active');
            });
            
            // Show target page
            const targetPage = document.getElementById(page);
            if (targetPage) {
                targetPage.style.display = 'block';
                targetPage.classList.add('active');
            }
            
            // Update navigation
            const navLinks = document.querySelectorAll('.admin-nav-link');
            navLinks.forEach(link => link.classList.remove('active'));
            
            const activeLink = document.querySelector(`[data-admin-page="${page}"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }
            
            // Load page-specific data
            if (page === 'courses-manage') {
                loadAdminCourses();
            } else if (page === 'course-create') {
                resetCourseForm();
            }
            
            console.log(`🔄 Admin navigated to: ${page}`);
        }

        async function loadAdminData() {
            try {
                await Promise.all([
                    loadDashboardStats(),
                    loadRecentCourses()
                ]);
            } catch (error) {
                console.error('❌ Error loading admin data:', error);
            }
        }

        async function loadDashboardStats() {
            try {
                const response = await fetch(`${AdminConfig.API_BASE_URL}${AdminConfig.ENDPOINTS.COURSES_PUBLIC}`);
                const courses = await response.json();
                
                if (Array.isArray(courses)) {
                    const totalCourses = courses.length;
                    const totalStudents = courses.reduce((sum, course) => sum + (course.students || 0), 0);
                    const avgRating = courses.reduce((sum, course) => sum + (course.rating || 0), 0) / courses.length;
                    const categories = [...new Set(courses.map(course => course.category).filter(Boolean))];
                    
                    // Update stat displays
                    document.getElementById('total-courses').textContent = totalCourses;
                    document.getElementById('total-students').textContent = totalStudents.toLocaleString();
                    document.getElementById('avg-rating').textContent = avgRating.toFixed(1);
                    document.getElementById('total-categories').textContent = categories.length;
                }
            } catch (error) {
                console.error('❌ Error loading dashboard stats:', error);
            }
        }

        async function loadRecentCourses() {
            try {
                const response = await fetch(`${AdminConfig.API_BASE_URL}${AdminConfig.ENDPOINTS.COURSES_PUBLIC}?limit=6`);
                const courses = await response.json();
                
                const container = document.getElementById('recent-courses');
                if (container && Array.isArray(courses)) {
                    container.innerHTML = courses.map(course => createCourseCard(course)).join('');
                }
            } catch (error) {
                console.error('❌ Error loading recent courses:', error);
            }
        }

        async function loadAdminCourses() {
            const container = document.getElementById('admin-courses-list');
            if (!container) return;
            
            try {
                container.innerHTML = '<div class="loading-state"><div class="loading-spinner"></div><p>Loading courses...</p></div>';
                
                const response = await fetch(`${AdminConfig.API_BASE_URL}${AdminConfig.ENDPOINTS.COURSES}`, {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load courses');
                }
                
                const courses = await response.json();
                
                if (Array.isArray(courses) && courses.length > 0) {
                    container.innerHTML = courses.map(course => createCourseRow(course)).join('');
                } else {
                    container.innerHTML = '<div class="empty-state"><p>No courses found</p></div>';
                }
            } catch (error) {
                console.error('❌ Error loading admin courses:', error);
                container.innerHTML = '<div class="error-state"><p>Failed to load courses</p></div>';
                showNotification('Failed to load courses', 'error');
            }
        }

        function createCourseRow(course) {
            return `
                <div class="course-row" data-course-id="${course.id}">
                    <img src="${course.image ? AdminConfig.API_BASE_URL + '/' + course.image : 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiBmaWxsPSIjZjFmNWY5Ii8+Cjx0ZXh0IHg9IjEyIiB5PSIxNiIgZm9udC1mYW1pbHk9IkludGVyIiBmb250LXNpemU9IjE0IiBmaWxsPSIjNjQ3NDhiIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5OaPC90ZXh0Pgo8L3N2Zz4K'}" alt="${course.title}" class="course-thumbnail">
                    <div class="course-info">
                        <h4>${course.title}</h4>
                        <p>${course.category || 'No category'} • ${course.instructor || 'Unknown instructor'}</p>
                    </div>
                    <div class="course-status published">Published</div>
                    <div class="course-students">${(course.students || 0).toLocaleString()} students</div>
                    <div class="course-actions">
                        <button class="action-btn edit" onclick="editCourse(${course.id})" title="Edit Course">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                        </button>
                        <button class="action-btn delete" onclick="deleteCourse(${course.id})" title="Delete Course">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3,6 5,6 21,6"/>
                                <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"/>
                            </svg>
                        </button>
                    </div>
                </div>
            `;
        }

        async function handleCourseSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const courseId = formData.get('courseId');
            
            try {
                // Show loading state
                const submitBtn = e.target.querySelector('button[type="submit"]');
                const submitText = document.getElementById('submit-text');
                const originalText = submitText.textContent;
                submitText.textContent = courseId ? 'Updating...' : 'Creating...';
                submitBtn.disabled = true;
                
                // Process tags and what you'll learn
                const tags = formData.get('tags');
                const whatYoullLearn = formData.get('whatYoullLearn');
                
                if (tags) {
                    formData.set('tags', JSON.stringify(tags.split(',').map(tag => tag.trim())));
                }
                
                if (whatYoullLearn) {
                    formData.set('whatYoullLearn', JSON.stringify(whatYoullLearn.split('\n').filter(line => line.trim())));
                }
                
                // API call
                const url = courseId 
                    ? `${AdminConfig.API_BASE_URL}${AdminConfig.ENDPOINTS.COURSES}/${courseId}`
                    : `${AdminConfig.API_BASE_URL}${AdminConfig.ENDPOINTS.COURSES}`;
                    
                const method = courseId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    },
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showNotification(
                        courseId ? 'Course updated successfully!' : 'Course created successfully!', 
                        'success'
                    );
                    navigateAdminPage('courses-manage');
                    loadAdminCourses();
                } else {
                    throw new Error(result.message || 'Failed to save course');
                }
            } catch (error) {
                console.error('❌ Error saving course:', error);
                showNotification(error.message || 'Failed to save course', 'error');
            } finally {
                const submitBtn = e.target.querySelector('button[type="submit"]');
                const submitText = document.getElementById('submit-text');
                submitText.textContent = courseId ? 'Update Course' : 'Create Course';
                submitBtn.disabled = false;
            }
        }

        async function editCourse(courseId) {
            try {
                const response = await fetch(`${AdminConfig.API_BASE_URL}${AdminConfig.ENDPOINTS.COURSES}`, {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });
                
                const courses = await response.json();
                const course = courses.find(c => c.id == courseId);
                
                if (course) {
                    currentEditingCourse = course;
                    populateCourseForm(course);
                    navigateAdminPage('course-create');
                    document.getElementById('course-form-title').textContent = 'Edit Course';
                    document.getElementById('submit-text').textContent = 'Update Course';
                }
            } catch (error) {
                console.error('❌ Error loading course for edit:', error);
                showNotification('Failed to load course data', 'error');
            }
        }

        function populateCourseForm(course) {
            document.getElementById('course-id').value = course.id;
            document.getElementById('course-title').value = course.title || '';
            document.getElementById('course-slug').value = course.slug || '';
            document.getElementById('course-category').value = course.category || '';
            document.getElementById('course-level').value = course.level || '';
            document.getElementById('course-instructor').value = course.instructor || '';
            document.getElementById('course-duration').value = course.duration || '';
            document.getElementById('course-students').value = course.students || '';
            document.getElementById('course-rating').value = course.rating || '';
            document.getElementById('course-description').value = course.description || '';
            document.getElementById('course-full-description').value = course.fullDescription || '';
            document.getElementById('course-prerequisites').value = course.prerequisites || '';
            document.getElementById('course-language').value = course.language || '';
            document.getElementById('course-udemy-link').value = course.udemyLink || '';
            document.getElementById('course-certificate').checked = course.certificate || false;
            document.getElementById('course-last-updated').value = course.lastUpdated || '';
            
            // Handle tags
            if (course.tags) {
                const tags = typeof course.tags === 'string' ? JSON.parse(course.tags) : course.tags;
                document.getElementById('course-tags').value = Array.isArray(tags) ? tags.join(', ') : '';
            }
            
            // Handle what you'll learn
            if (course.whatYoullLearn) {
                const whatYoullLearn = typeof course.whatYoullLearn === 'string' ? JSON.parse(course.whatYoullLearn) : course.whatYoullLearn;
                document.getElementById('course-what-learn').value = Array.isArray(whatYoullLearn) ? whatYoullLearn.join('\n') : '';
            }
        }

        function resetCourseForm() {
            currentEditingCourse = null;
            document.getElementById('course-form').reset();
            document.getElementById('course-id').value = '';
            document.getElementById('course-form-title').textContent = 'Add New Course';
            document.getElementById('submit-text').textContent = 'Create Course';
        }

        async function deleteCourse(courseId) {
            if (!confirm('Are you sure you want to delete this course? This action cannot be undone.')) {
                return;
            }
            
            try {
                const response = await fetch(`${AdminConfig.API_BASE_URL}${AdminConfig.ENDPOINTS.COURSES}/${courseId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });
                
                if (response.ok) {
                    showNotification('Course deleted successfully', 'success');
                    loadAdminCourses();
                } else {
                    throw new Error('Failed to delete course');
                }
            } catch (error) {
                console.error('❌ Error deleting course:', error);
                showNotification('Failed to delete course', 'error');
            }
        }

        async function refreshCourses() {
            showNotification('Refreshing courses...', 'info');
            await loadAdminCourses();
        }

        // Utility functions (reuse from main app)
        function showNotification(message, type = 'info', duration = 4000) {
            const container = document.getElementById('notification-container');
            if (!container) return;
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <div class="notification-message">${message}</div>
                    <button class="notification-close" onclick="this.parentElement.parentElement.remove()">×</button>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Trigger animation
            requestAnimationFrame(() => {
                notification.classList.add('show');
            });
            
            // Auto remove
            if (duration > 0) {
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }, duration);
            }
        }

        function generateSlug(text) {
            return text
                .toLowerCase()
                .trim()
                .replace(/[^\w\s-]/g, '')
                .replace(/[\s_-]+/g, '-')
                .replace(/^-+|-+$/g, '');
        }

        function createCourseCard(course) {
            const instructorInitial = course.instructor ? course.instructor.charAt(0).toUpperCase() : 'K';
            
            return `
                <article class="course-card" data-course-id="${course.id}">
                    <div class="course-image">
                        ${course.image 
                            ? `<img src="${AdminConfig.API_BASE_URL}/${course.image}" alt="${course.title}" loading="lazy">`
                            : `<div class="course-image-placeholder">📚</div>`
                        }
                        <div class="course-badge">${course.level || 'All Levels'}</div>
                    </div>
                    <div class="course-content">
                        <div class="course-meta">
                            <span class="course-category">${course.category || 'General'}</span>
                            <span class="course-level">${course.level || 'All Levels'}</span>
                        </div>
                        <h3 class="course-title">${course.title}</h3>
                        <p class="course-description">${course.description || 'No description available.'}</p>
                        ${course.instructor ? `
                            <div class="course-instructor">
                                <div class="instructor-avatar">${instructorInitial}</div>
                                <span>${course.instructor}</span>
                            </div>
                        ` : ''}
                        <div class="course-stats">
                            <div class="course-rating">
                                <span>⭐</span>
                                <span>${course.rating || '4.5'}</span>
                            </div>
                            <div class="course-students">${(course.students || 1000).toLocaleString()} students</div>
                            <div class="course-duration">${course.duration || '8 weeks'}</div>
                        </div>
                    </div>
                </article>
            `;
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('korelium-theme', newTheme);
            updateThemeToggleIcon();
            showNotification(`Switched to ${newTheme} mode`, 'info');
        }

        function updateThemeToggleIcon() {
            const themeToggles = document.querySelectorAll('.theme-toggle .theme-icon');
            const currentTheme = document.documentElement.getAttribute('data-theme');
            themeToggles.forEach(icon => {
                icon.textContent = currentTheme === 'dark' ? '🌙' : '☀️';
            });
            
            const currentThemeText = document.getElementById('current-theme');
            if (currentThemeText) {
                currentThemeText.textContent = currentTheme === 'dark' ? 'Dark Mode' : 'Light Mode';
            }
        }

        // Check API status
        async function checkApiStatus() {
            try {
                const response = await fetch(`${AdminConfig.API_BASE_URL}/`);
                const statusElement = document.getElementById('api-status');
                if (statusElement) {
                    if (response.ok) {
                        statusElement.textContent = 'Connected';
                        statusElement.className = 'course-status published';
                    } else {
                        statusElement.textContent = 'Error';
                        statusElement.className = 'course-status draft';
                    }
                }
            } catch (error) {
                const statusElement = document.getElementById('api-status');
                if (statusElement) {
                    statusElement.textContent = 'Offline';
                    statusElement.className = 'course-status draft';
                }
            }
        }

        // Check API status on load
        setTimeout(checkApiStatus, 1000);
        
        console.log('🔐 Korelium Admin panel loaded successfully!');
    </script>
</body>
</html>